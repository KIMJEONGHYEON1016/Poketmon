<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="org.choongang.rank.mapper.RankMapper">
    <resultMap id="rankMap" type="org.choongang.rank.entities.Rank">
        <result column="USER_NO" property="userNo" />
        <result column="USER_ID" property="userId" />
    </resultMap>

    <select id="getScore" resultType="org.choongang.rank.entities.Rank">
        <![CDATA[SELECT RANKING, USER_ID, POKEMON_COUNT
FROM (
    SELECT RANK() OVER (ORDER BY POKEMON_COUNT DESC) AS RANKING, USER_ID, POKEMON_COUNT
    	FROM (
        	SELECT M.USER_ID, COUNT(MP.POKEMON_NO) AS POKEMON_COUNT
        		FROM MEMBER M LEFT JOIN MYPOKEMON MP ON M.USER_NO = MP.USER_NO GROUP BY M.USER_ID
    		 )
	  )
		WHERE RANKING IN (1)]]>
    </select>
</mapper>